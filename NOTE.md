# Web 製作者のための CSS 設計の教科書

『Web 製作者のための CSS 設計の教科書』のメモ。

"壊れない完璧な設計を求めるのではなく、壊れたときに勇気を持って修復できる設計を" 斉藤祐也

# 目次

- CSS の設計とは
- CSS の基本
- コンポーネント設計のアイデア
  - OOCSS
  - SMACSS
  - BEM
  - MCSS
  - FLOCSS
- コンポーネント設計の実践
- CSS プリプロセッサ
- コンポーネントの運用
  - スタイルガイド
- Web Components

5 min

# 1 CSS における設計とは

## 1-1 CSS 設計の重要性

- ぼくの気になる点は CSS における設定がなぜ重要でなぜ必要なのか。

- デザインをブラウザで表現するだけではない
- 運用の中でたくさんの人がメンテナンスする
- コンテンツが増える
- キャンペーンやリニューアルなどで変更する
- 後任者 (あるいは 1 ヶ月後の自分)が困らないように

5 min

- メンテナンスがしやすいように
- HTML5 の登場など Web サイトの複雑化

- ぼくとしてはソフトウェアの品質特性と同じようなものを確保するために必要。
  - http://www15.ocn.ne.jp/~squality/software-quality/iso9126.htm
- いきあたりばったりだと破綻しやすい (経験則)

5 min


- ゴール
  - 予測しやすい
    - 保守性 解析性
    - 保守性 安定性 デグレードもここに含んでいるようで
  - 再利用しやすい
    - 保守性 安定性 再利用に
    - 保守性 変更性 再利用しやすければ変更にかかる労力を減らせる
    - 移植性 設置性 (コンポーネント単位でみたときの評価？)
  - 保守しやすい
    - 保守性 解析性
    - 保守性 変更性
    - 保守性 安定性
  - 拡張しやすい
    - 保守性 変更性
    - 保守性 安定性

- 保守性 解析性 保守の範囲特定をしやすいか
- 保守性 変更性 追加をしやすいか
- 保守性 安定性 デグレードしやすいか
- 保守性 試験性 テストしやすいか

まとめると

- 保守性をたかめるためにルールを決めましょう (なんだか説得力にかけるけど……)


5 min

## 1-2 破綻しやすい CSS

- CSS は宣言的な言語。
- `.selector { property: value }` というフォーマットを覚えれば書ける。
- 書くだけなら簡単だが容易に破綻する。
  - ？どうして？
- 理由: HTML の構造に依存している
  - セレクタの書きかたにもよるが HTML の構造が変わると破綻する。
  - HTML で class を指定しておきセレクタには class を使うと良い。

5 min

- 理由: スタイルを取り消している
  - 打ち消すルールとクラスを追加する→無駄な行が増える
  - 追加するルールとクラスにしておくほうが良い
    - 個人的には CSS の打ち消すがまずいというよりはルール間の相互干渉が分かりづらいと破綻しやすい気がする。
- 理由: 絶対値を多用している
  - line-height に絶対値を指定している
    - 個人的には line-height の例は適切でないと思う。
    - line-height の数値指定が何を表すのかを理解しているのは前提
    - font-size に合わせて line-height を変えるべきとは限らない
    - line-height を抽出して継承を前提とすることは HTML の構造への依存度を高めている。
      - .introduction .lead な HTML 構造を前提条件として追加してしまっている。
- 理由: モダンなサイト構築ワークフロー
  - 反復的なワークフローの場合に手戻りを減らす

あれ、なんか途中から「破綻の理由」じゃなくなっているような。

個人的には CSS が破綻しやすいのは、HTML 構造への依存、継承の仕組みなどによる影響範囲の特定の難しさにあると思っている。 #hitoridokusho

まとめるとぼくの思う破綻の理由は

- HTML 構造の変更が CSS のセレクタから外れる原因に直結する。
- 親要素からの継承や class などにより意図しないルールが適用される。
- そして事前の設計やルール化がされていないと上記の問題が発生しやすくなる。

5 min

# 2 CSS の基本を振り返る

## 2-1 CSS セレクタと詳細度

- カスケーディング(継承)の話
- 詳細度の話
  - !important
  - style=""
  - id="id" / #id
  - class="class" / .class
  - attr="value" / [attr="value"]
  - :first-child
  - element
  - ::after
  - *

まとめると

- 新しい話はない。復習。
- CSS 設計上は抑えておかないと話にならない。

## 2-2 セレクタのリファクタリング

- ？装飾を維持しながら詳細度を下げることをリファクタリングと呼んでいる？
- 要素セレクタを省略する
- セレクタを短くする (子孫セレクタの中間を削除する)
- セレクタを限定的にする (子セレクタを使う)
- クラスセレクタを活用する

結局一番大きいのはクラスセレクタをどう活用するか、かな。 CSS 設計は同時に HTML 設計でもある。コンポーネント設計と呼ばれることが多いのかな。

まとめると

- 余計な指定で詳細度を上げるな。
  - 上書きがしづらくなるなど問題が多い。
- 重要なのはクラスセレクタをどう活用するか。
- CSS 設計は HTML 設計であり、コンポーネント設計である、とぼくは感じる。

5 min

# 3 コンポーネント設計のアイデア

## 3-1 CSS におけるコンポーネント設計

- コンポーネントの説明
- 関心の分離 (separation of concerns)
  - 機能や振る舞いなどを明確に分離をする
- ？ぼくはそこまでの意味では使っていなくて「部品」とかあるいは何かの「単位」を指しているかな。
- カプセル化
  - ？なんだか怪しい説明文だ……
  - コンポーネント間で相互に変更の影響が出ないようにする……という意味で挙げているのかな。
  - で、これは CSS には備わっていない、と。
  - ID セレクタでくくっても意味がないよという話
    - #news .title {} が .title {} の影響を受ける例
- 既存のコンポーネント設計のためのアプローチを見ていく。

- コンポーネントの説明としてはあんまり良くない気がする。
- ぼくは「部品」やひとまとまりになっている「単位」程度の意味で良いと思う。
- カプセル化の問題は 1-2 の破綻の理由に加えるべきかも。
  - 予期せぬルールが適用されてしまう→変更の影響範囲をつかみにくい。
  - 設計なしに class を付与すると予期せぬルールが適用されてしまう可能性がある

5 min

各章まとめ追記

5 min

まとめると

- 2-2 と重複するけどコンポーネント設計が要る。
- CSS の保守性 (意図しないルールの適用を防ぐなど) のために。

## 3-2 OOCSS

- OOCSS : Object Oriented CSS
- OOCSS の原則
  - 構造と見た目の分離
  - コンテナーとコンテンツとを分離
- 構造と見た目の分離
  - .alert と .success / .warning / .error とを分離させる。
  - 基本的な構造 (?) は変わらないのでそれを .alert に、文字色などの見た目をその他に。
- クラスセレクタを使っていく
- 要素セレクタは HTML 構造への依存を強くするので使わない
  - ？要素セレクタを使うということは子孫セレクタを使うということ
  - ？子孫セレクタは詳細度が上がっていく
- ID セレクタは再利用のために使わない
  - 著者は基本的には割けるが一意だと明らかなものには使う。
  - 詳細度の観点でも問題がある。

5 min

- コンテナーとコンテンツとを分離
  - 場所に依存しないセレクタを書く
- class を追加することで場所に依存する ルールを追加する
  - `class="logo logo-small"`

まとめると

- OOCSS は「構造と見た目の分離」と「コンテナとコンテンツ」との分離を意識する。
- OOCSS はクラスの再利用を前提としている。
- OOCSS はマルチクラス設計。
- OOCSS はおそらく子孫セレクタよりもクラスを複数組み合わせることで対応することを良しとしている。
- クラスセレクタを使う。
- 要素セレクタを使わない。
  - HTML 構造への依存が強まるため。
  - 子孫セレクタが前提になり詳細度が上がるため。
  - 影響範囲が HTML 構造次第になるため。
- ID セレクタを使わない。
  - 再利用のため。
  - 詳細度が上がるため。

5 min

## 3-3 SMACSS

- SMACSS
- OOCSS のコンセプトをベースにつくられたガイドライン
- カテゴリ
  - Base
  - Layout
  - Module
  - State
  - Theme
- Base
  - 要素のデフォルト
- Layout
  - ヘッダー・フッターのようなセクションをつくる要素へのルール
  - ID セレクタでも良い
  - Grid Layout もここに含める

5 min

- Module
  - ボタンや見出しなど再利用できるものはここに含める
- State
  - 状態を表すクラス
  - JavaScript で制御で切り替えられる想定
  - is- prefix をつける
  - !important も許容する
  - メディアクエリも含む
  - 他のクラスとの組み合わせで定義する `.tab.is-active {}`

5 min

- Theme
  - テーマ切り替え用

- クラス名にコンポーネント名を含む `.alert.warning` ではなく `.alert-warning`
  - スタイルの競合と汚染のリスクを減らせる
  - どのコンポーネントを拡張するものかが分かる
  - セレクタの詳細度を減らせる
- HTML と CSS とを分離する
  - なるべく class を振る
  - HTML 構造への依存を減らす

5 min

- 個人的な意見として BEM などの長大なクラス名は気持ち悪いと感じる。
  - 例えばユーザー名を含んでいるブロックはせいぜい user-name であって、sidebar--user-profile--user-name ではない。 CSS の実装上の都合を HTML に押し付けすぎているように感じる。
- クラスを振っておくのは良いアプローチだと思う。ただの要素ではなく何を含む要素なのかを明確にできるので HTML としても正しい。
- HTML 構造への依存を減らすのも良い。ただ完全になくそうと思うとおそらく BEM のような一意な class を振らないといけなくなるので

5 min

## 3-4 BEM

- BEM : Block Element Modifier
- Block 命名の基点 `.alert`
- Element Block を構成する要素 `.alert__title`
- Modifier Block または Element のバリエーション違いの要素 `.alert_warning`
- MindBEMding では区切り記号として `__` と `--` とを使う
  - Element が `__`
  - Modifier が `--`

まとめると

- 構成要素とバリエーションとを特殊な文字で区切ることで明確にする

5 min

## 3-5 MCSS

- MCSS : Multilayer CSS
- 構成
  - Foundation
  - Base
  - Project
  - Cosmetic
- レイヤー間の依存関係を明確にしたもの
- クラス名の省略も推奨している

5 min

- Foundation …… SMACSS の Base 。 reset  / normalize
- Base …… 再利用可能な部品 SMACSS の Module 。Boostrap などの一部をこのレイヤーに含めても良い。
- Project …… クラスを組み合わせることで Base レイヤーを上書きできる。Base レイヤーが Project レイヤーを上書きはできない。
- Cosmetic …… リンクカラーやグローバルな modifier など。ひとつの要素に三個まで。

5 min

- Context ……  必要に応じてルールを上書きできる。メディアクエリーなど。

レイヤーとしてつくって下層をさわらないのはよくある仕組みだけど良いアイデアだと思う。
ほかのフレームワークにしても同じような制約は暗黙のうちにあるような気がする。

まとめると

- Multilayer 化してレイヤー間に依存関係をもたせている

5 min

## 3-6 FLOCSS

- FLOCSS
- Foundation / Layout / Object
- Foundation …… SMACSS の Base / MCSS の Foundation
- Layout …… SMACSS の Layout (汎用のものは Object に含める)
- Object …… 再利用可能なコンポーネント
  - Component …… MCSS の Base
  - Project …… MCSS の Project
  - Utility …… MCSS の Cosmetic / clearfix

5 min

- クラスの命名は BEM
- 状態を表す Modifier は SMACSS の State のように is- prefix を付与する。
- is- そのもののルールを定義しない。
- その他の prefix もつける

5 min

- カスケーディング
- レイヤー間のカスケーディングや子孫セレクタによるカスケーディングを禁止

自分ルールを検討

- 層の深さは 3 層で良い気がする。
- is- は良いがそれ以外の  prefix はあまり好きでない。
- BEM も好きでない。
- マルチクラスを避けられないものか。
- コンポーネントについてはクラスとして定義せず mixin とするほうが良い
